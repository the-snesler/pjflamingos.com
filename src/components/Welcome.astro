---
import { Image } from "astro:assets";
import background from "../assets/background.png";
import { getCollection, getEntry } from "astro:content";
import logo from "../assets/logocolor.png";
import { Icon } from "astro-icon/components";
const allEvents = await getCollection("events");
const upcomingEvents = allEvents
  .filter((event) => {
    return event.data.date >= new Date();
  })
  .sort((a, b) => a.data.date.getTime() - b.data.date.getTime());
---

<div class="pb-16">
  <main>
    <section id="hero">
      <Image
        id="hero-image"
        src={background}
        alt=""
        fetchpriority="high"
        width="960"
      />
      <div
        class="absolute inset-0 bg-gradient-to-b from-transparent via-flamingo/20 to-black"
      >
      </div>
      <div
        class="absolute inset-0 flex flex-col justify-center items-center text-center text-white px-4"
      >
        <Image src={logo} alt="Logo" class="w-3/4 max-w-lg mb-4" />
        <p>A jazz combo from La Crosse, Wisconsin</p>
      </div>
    </section>
    <section id="events">
      <h1 class="text-6xl text-flamingo font-serif text-center my-8">
        Upcoming Events
      </h1>
      <div class="flex flex-col gap-8 mb-12">
        {
          upcomingEvents.length > 0 ? (
            upcomingEvents.map((event) => (
              <div class="block max-w-3xl mx-auto p-6 bg-black/50 backdrop-blur-sm border border-flamingo rounded-lg text-white">
                <h2 class="text-3xl font-semibold mb-2">{event.data.title}</h2>
                <p class="mb-1">
                  <Icon name="lucide:calendar" class="inline align-baseline" />
                  <i>
                    {event.data.date.toLocaleDateString("en-US", {
                      year: "numeric",
                      month: "long",
                      day: "numeric",
                      hour: "numeric",
                      minute: "numeric",
                      hour12: true,
                    })}
                    {event.data.endDate
                      ? ` - ${event.data.endDate.toLocaleTimeString("en-US", {
                          hour: "numeric",
                          minute: "numeric",
                          hour12: true,
                        })}`
                      : ""}
                  </i>
                </p>
                <p class="mb-1">
                  <Icon name="lucide:map-pin" class="inline align-baseline" />
                  <a
                    href={event.data.locationHref}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="italic underline text-accent hover:text-flamingo"
                  >
                    {event.data.location}
                    <Icon
                      name="lucide:arrow-up-right"
                      class="inline align-baseline"
                    />
                  </a>
                </p>
                {event.data.description && (
                  <p class="mt-2">{event.data.description}</p>
                )}
                <a
                  href={event.data.ticketsHref}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-block mt-4 px-4 py-2 bg-flamingo text-black font-semibold rounded hover:bg-flamingo/80 transition-colors duration-200"
                >
                  Get Tickets
                </a>
              </div>
            ))
          ) : (
            <div class="max-w-3xl mx-auto text-center text-white">
              <p>
                Check back soon for upcoming events! In the meantime, follow us
                on Instagram and YouTube to stay updated.
              </p>
            </div>
          )
        }
      </div>
    </section>
  </main>

  <style>
    #hero {
      position: relative;
      height: min(100vh, 910px);
      width: 100%;
      overflow: hidden;
    }
    #hero-image {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      transform: scale(1.05);
      filter: brightness(0.75) blur(4px);
      object-fit: cover;
    }
  </style>
</div>
